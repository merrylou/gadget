# ARCHIVE: POMODORO — Project Rules（改訂版）

> 目的：**「壊さずに進める」**ことを最優先にする。
> 失敗パターン（出来ていた部分が壊れる）を、**手順とガードレール**で潰す。

---

## 0. 用語

* **正本（Golden Source）**：絶対に編集しない基準ファイル
* **作業ファイル（Work）**：実際に編集するファイル
* **チェックポイント（Checkpoint）**：動作確認済みの保存点（復帰可能）

---

## 1. 正本（Golden Source）

* **`archive-pomodoro (4).html`** を正本とする
* 正本は **一切編集しない**（閲覧・比較のみ）

---

## 2. 作業用ファイルとチェックポイント

### 2.1 作業開始手順（必須）

1. 正本をコピーして作業ファイルを作る

```text
archive-pomodoro (4).html  →  archive-pomodoro.work.html
```

2. **以降の編集は `archive-pomodoro.work.html` のみ**

### 2.2 チェックポイント運用（重要）

* 1つの変更要求（=1機能/1修正）を入れる前に、必ずチェックポイントを作る

```text
archive-pomodoro.work.html  →  archive-pomodoro.cp-YYYYMMDD-HHMM-<topic>.html
```

例：

* `archive-pomodoro.cp-20260203-1030-fix-inline-app.html`

* `archive-pomodoro.cp-20260203-1115-url-icon-ui.html`

* 何か壊れたら「原因調査」より先に **直前チェックポイントへ戻す**

---

## 3. 変更の粒度と順序

### 3.1 1リクエスト=1変更（絶対）

* 1回でやるのは **1つの目的だけ**
* 例：

  * ✅「UNDO表示条件だけ直す」
  * ❌「UNDOとURLとログを同時に直す」

### 3.2 変更順序（固定）

1. **構文エラー解消**（Consoleに赤が出ない）
2. **主要導線復旧**（NEW/SAVE/表示が動く）
3. **機能追加（小）**（URL・アイコン等）
4. **DB変更（大）**（logs追加等）
5. **UX改善（見た目/演出）**

---

## 4. 変更の受入条件（Definition of Done）

変更を「採用」する前に、必ず下記を全部チェックする（3分で終わる）。

### 4.1 コンソール

* Consoleに **赤エラーが0**

### 4.2 最小回帰テスト（必須）

* `+ NEW` → モーダルが開く
* SAVE → タスクが表示される
* FOCUS/UNFOCUS が動く
* DONE → ARCHIVEDに移動
* ARCHIVED → Readonlyで開く
* UNDO → Activeに戻る

※今回の変更がURLなら追加で：

* URL保存 → 再度EDITして残っている
* 🔗から開ける

---

## 5. AI（Codex）利用ルール（強化版）

### 5.1 Codexに渡す“制約テンプレ”（必ず付ける）

* **変更対象を明示**：関数名／DOM id／ブロック名
* **禁止を明示**：触るな（HTML/CSS/他関数）
* **出力形式を要求**：差分（変更箇所のみ）

テンプレ：

```text
制約：
- HTML構造は変更しない
- CSSは変更しない（必要なら最小限の追記のみ）
- 変更対象は <対象関数/ブロック> のみ
- それ以外は一切変更禁止

出力：
- 変更した箇所だけ（パッチ/差分）
```

### 5.2 Codexの変更を受け入れる条件

* 差分が「想定範囲（対象関数/箇所）」に収まっている
* それ以外の関数・HTML構造に変更が入っていない
* 受入条件（Section 4）を満たす

### 5.3 禁止事項（明文化）

* “全体を書き換え”
* “openModal/render/DBをまとめて修正”
* “原因不明の最適化・整理・リファクタ”
* “テンプレ文字列（`）を広範囲に触る変更”

---

## 6. 事故防止の実務ルール（追加）

* **差分レビュー**：Codexの提案は適用前に必ず差分を目視（特に openModal / render / DB）
* **戻す勇気**：壊れたら直す前にチェックポイントへ戻す
* **大きい変更は分割**：DB verアップ・store追加は単独タスクで実施

---

このルールは、プロジェクトの安全性と再現性を担保するための**不変の前提条件**とする。
